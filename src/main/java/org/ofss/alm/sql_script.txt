-- ========================
-- CUSTOMER
-- ========================
CREATE TABLE Customer (
    CustomerID       NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name             VARCHAR2(200) NOT NULL,
    Type             VARCHAR2(50) CHECK (Type IN ('Individual', 'Corporate')),
    CreatedOn        TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ========================
-- CURRENCY
-- ========================
CREATE TABLE Currency (
    CurrencyCode     VARCHAR2(3) PRIMARY KEY, -- e.g. USD, INR
    CurrencyName     VARCHAR2(50) NOT NULL,
    FXRateToBase     NUMBER(18,8) NOT NULL,
    EffectiveDate    DATE NOT NULL
);

-- ========================
-- ASSET
-- ========================
CREATE TABLE Asset (
    AssetID          NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CustomerID       NUMBER NOT NULL,
    AssetType        VARCHAR2(50) NOT NULL, -- Loan, Investment, Bond, etc.
    CurrencyCode     VARCHAR2(3) NOT NULL,
    PrincipalAmount  NUMBER(18,2) NOT NULL,
    InterestRate     NUMBER(9,4),
    MaturityDate     DATE,
    CreatedOn        TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_asset_customer FOREIGN KEY (CustomerID) REFERENCES Customer(CustomerID),
    CONSTRAINT fk_asset_currency FOREIGN KEY (CurrencyCode) REFERENCES Currency(CurrencyCode)
);

-- ========================
-- LIABILITY
-- ========================
CREATE TABLE Liability (
    LiabilityID      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CustomerID       NUMBER NOT NULL,
    LiabilityType    VARCHAR2(50) NOT NULL, -- Deposit, Borrowing, etc.
    CurrencyCode     VARCHAR2(3) NOT NULL,
    PrincipalAmount  NUMBER(18,2) NOT NULL,
    InterestRate     NUMBER(9,4),
    InterestPayoutDate     DATE,
    CreatedOn        TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_liability_customer FOREIGN KEY (CustomerID) REFERENCES Customer(CustomerID),
    CONSTRAINT fk_liability_currency FOREIGN KEY (CurrencyCode) REFERENCES Currency(CurrencyCode)
);

-- ========================
-- TRANSACTION
-- ========================
CREATE TABLE Transaction (
    TransactionID    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    AssetID          NUMBER,
    LiabilityID      NUMBER,
    TransactionType  VARCHAR2(50) CHECK (TransactionType IN ('Disbursement','Repayment','Interest Payment','Deposit','Withdrawal')),
    Amount           NUMBER(18,2) NOT NULL,
    TransactionDate  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_txn_asset FOREIGN KEY (AssetID) REFERENCES Asset(AssetID),
    CONSTRAINT fk_txn_liability FOREIGN KEY (LiabilityID) REFERENCES Liability(LiabilityID),
    CONSTRAINT chk_txn_one_side CHECK (
        (AssetID IS NOT NULL AND LiabilityID IS NULL) OR
        (AssetID IS NULL AND LiabilityID IS NOT NULL)
    )
);

-- ========================
-- RISK METRICS
-- ========================
CREATE TABLE RiskMetrics (
    RiskMetricsID    NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    AssetID          NUMBER,
    LiabilityID      NUMBER,
    Duration         NUMBER(18,6),
    Convexity        NUMBER(18,6),
    NIIContribution  NUMBER(18,2), -- Net Interest Income contribution
    LiquidityImpact  NUMBER(18,2),
    LastCalculatedOn TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_rm_asset FOREIGN KEY (AssetID) REFERENCES Asset(AssetID),
    CONSTRAINT fk_rm_liability FOREIGN KEY (LiabilityID) REFERENCES Liability(LiabilityID),
    CONSTRAINT chk_rm_one_side CHECK (
        (AssetID IS NOT NULL AND LiabilityID IS NULL) OR
        (AssetID IS NULL AND LiabilityID IS NOT NULL)
    )
);

-- ========================
-- SCENARIO
-- ========================
CREATE TABLE Scenario (
    ScenarioID       NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ScenarioName     VARCHAR2(100) NOT NULL,
    Description      VARCHAR2(500),
    ShockType        VARCHAR2(50), -- e.g. InterestRateShock, LiquidityShock
    ShockValue       NUMBER(18,4),
    CreatedOn        TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ========================
-- SCENARIO RESULT
-- ========================
CREATE TABLE ScenarioResult (
    ScenarioResultID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ScenarioID       NUMBER NOT NULL,
    AssetID          NUMBER,
    LiabilityID      NUMBER,
    MetricName       VARCHAR2(100) NOT NULL,
    MetricValue      NUMBER(18,6),
    CONSTRAINT fk_sr_scenario FOREIGN KEY (ScenarioID) REFERENCES Scenario(ScenarioID),
    CONSTRAINT fk_sr_asset FOREIGN KEY (AssetID) REFERENCES Asset(AssetID),
    CONSTRAINT fk_sr_liability FOREIGN KEY (LiabilityID) REFERENCES Liability(LiabilityID),
    CONSTRAINT chk_sr_one_side CHECK (
        (AssetID IS NOT NULL AND LiabilityID IS NULL) OR
        (AssetID IS NULL AND LiabilityID IS NOT NULL)
    )
);
